### 1、编码规范
    ·   遵循 PEP8 编码规范。尽可能减少波浪线的出现。(专有名词除外)
    ·   类名使用CamelCase(大驼峰)，函数命名使用Snake Case(小写字母加下划线)
    ·   常量写入常量表，使用全大写字母。
    ·   函数名，类名需表意，能让他人一眼看出这个方法做了什么事。
    ·   一份良好的代码，不需要太多的注释，方法名，变量名就是注释。当然复杂逻辑建议留下注释
    ·   对于注释，使用英文，保持简单明了。不推荐中文，中文在某些情况下会引发异常(编译失败)。
    ·   对于函数返回，尽量保持属性一致性。
    ·   对于同一类的文件如果不能分文件，使用同一前缀，可自动排序，方便查找。

### 2、任务设计 task

        celery 天然支持生产者消费者模型。 将生产者消费者解耦。使用消息队列来充当缓冲区。
        对于celery保证消息队列足够容纳生产者产生的任务。


    1、设定队列优先级。 默认<中级<高级。
    2、定时任务。
    3、建立任务统计机制。对任务实施统计。(后台管理系统)
        ·   建立任务统计表，设定接口，一键获取所有任务信息。



### 3、日志设计
    阿里云日志库参见文档（../阿里云日志服务/阿里云日志库设计文档.md）

    日志规范
        ·   单一生命周期任务，需保持可追踪的连贯性。(输出需能识别该日志产生的事件，如task_id,user_name 等)
        ·   关键位置必须写日志。如入口，结束位置，异常捕获位置，关键参数位置。
        ·   日志必须能够定位这个问题的发生地点及触发参数。即谁触发，什么时候触发，触发了什么，触发的位置等信息。


### 4异常处理
    1、   重试机制-(增强代码健壮性)

        ·   不同场景，重试机制不一样。
            # 网络闪断引起
            # 对方api 限定请求次数

    2、   异常必须添加日志

    3、   致命性异常，实现短信通知，或邮件通知

### 5、 引入新etcd 新机制，将生产环境配置和开发环境配置隔离。
    实现开发配置与生产环境配置分离

### 6、模块划分
    每个模块是一个微服务。

    划分原因：
        1、降低项目整体耦合
        2、方便任务分配，减少代码交叉，每个人负责自己的模块
        3、可暂停某个模块 进行维护更新，逐步替代。强耦合只要某个平台或业务出现问题，大概率影响全局。且每次更新都要停止所有业务。
        4、方便扩展，如后期要引入微博，微信等只需添加对应的模块



### 7、单独模块结构

    · 核心思想： 层次分明，易于查找。

```json
|--script (脚本文件，可直接运行，针对特定任务的一次性代码)
|--src
    |---api
       |----v1
           |-----视图函数1
           |-----视图函数2
             .....
    |---common   (本项目通用数据，error_code等一些通用方法)
    |---date     (本项目产生的一些文件)
    |---logger   (日志文件)
    |---wrapper   (数据库连接句柄，或其他映射关系)
    |   |----etcd_wrapper.py (etcd 连接处理)
    |   |----settings_file_wapper.py (用于生成settings.py文件)
    |   |----msyql
        |----mongo
            .....
    |---module   (模型类，如：mysql，mongodb等可以建立模型的文件)
    |---orm      (数据库操作，对不同的数据库操作得分层)
    |---service  (针对不同接口封装的服务)
    |---task
        |----celery_task (celery 异步任务)
        |----cyclic_task (寻常周期任务)
    |---utils    (常用函数所在文件夹，如：获取当前日期，加密方法等)
    |---app.py   (入口文件)
    |---config.yaml  (变量配置文件)
    |---const.py (常量表，代码中的魔法数字或字符串都放在这里)
    |---globals.py    (全局变量方法，项目中需要实现为全局的，将放入这里，如数据库的连接等)
    |---initialization.py (启动文件。对各项服务的初始化)
    |---requirement.txt   (本项目中用到的包及版本文件)
    |---settings.py       (配置展示文件)

|--test     (单元测试文件夹，对不同的单元测试做好分类。)

```
    使用事项：
        1、通过配置本地环境变量 写入etcd ip和host
            ip： ETCD_SERVICE_SERVICE_HOST
            host: ETCD_SERVICE_SERVICE_PORT
        2、可以通过本地环境变量及config.yaml 文件控制读取的配置来自线上还是本地
            决定读取本地还是etcd： debug_method :: 0 etcd  1 读取本地

### 8、代码隔离问题
    利：
        1、加速新同事编码效率，减少学习成本
        2、产权保护
    弊：
        1、上下文考虑不清晰，逻辑容易写偏
        2、需要二次移植。需花费时间编辑，测试。及数据结构交流，增加维护成本

    ·   1 综合考虑不建议特意将代码做分离。
    ·   2 针对学习新项目结构问题 可以直接告诉他代码填写位置，如何启动代码。
    ·   3 任务分配时，合理安排任务--同一类型的代码有限安排同一位同事处理，减少代码交叉，
    ·   4 严格遵循git 管理规范，必须先本地合并代码才能提交到仓库。每位同事建立自己的开发环境。

    针对特定的情况可以使用隔离： 如脚本性质代码。 可以存放在专门的script文件

